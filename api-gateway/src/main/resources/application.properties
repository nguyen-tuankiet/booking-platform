# ========== Server ==========
server.port=8080

# ========== Application ==========
spring.application.name=api-gateway

# ========== Eureka ==========
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
eureka.client.fetch-registry=true
eureka.client.register-with-eureka=true
eureka.instance.prefer-ip-address=true
eureka.instance.lease-renewal-interval-in-seconds=30
eureka.instance.lease-expiration-duration-in-seconds=90

# ========== Gateway Discovery ==========
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# ========== Circuit Breaker ==========
spring.cloud.gateway.default-filters[0]=name=CircuitBreaker
spring.cloud.gateway.default-filters[0].args.name=defaultCircuitBreaker
spring.cloud.gateway.default-filters[0].args.fallbackUri=forward:/fallback

# Circuit Breaker Configuration
resilience4j.circuitbreaker.instances.defaultCircuitBreaker.sliding-window-size=10
resilience4j.circuitbreaker.instances.defaultCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.defaultCircuitBreaker.wait-duration-in-open-state=10000
resilience4j.circuitbreaker.instances.defaultCircuitBreaker.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.defaultCircuitBreaker.minimum-number-of-calls=5

# ========== JWT Configuration ==========
jwt.secret=in8roOCvJUSjXDse/fo4UNznTOrbw9z1Yml9wiJ/ItI/+Bxe8ju6VLLm8GamJYDajKK87lZJYBviPqAFaweV7g==
jwt.expiration=86400000
jwt.refresh-expiration=604800000

# ========== Redis Configuration ==========
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0

# ========== Rate Limiting ==========
gateway.rate-limit.default.max-requests=100
gateway.rate-limit.default.window-minutes=1
gateway.rate-limit.auth.max-requests=200
gateway.rate-limit.payment.max-requests=50

# ========== Timeout Configuration ==========
spring.cloud.gateway.httpclient.connect-timeout=5000
spring.cloud.gateway.httpclient.response-timeout=30s
spring.cloud.gateway.httpclient.pool.type=elastic
spring.cloud.gateway.httpclient.pool.max-connections=100
spring.cloud.gateway.httpclient.pool.max-idle-time=30s

# ========== Actuator ==========
management.endpoints.web.exposure.include=health,info,gateway,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.endpoint.gateway.enabled=true
management.prometheus.metrics.export.enabled=true

# ========== Logging ==========
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.com.booking.api_gateway=DEBUG
logging.level.org.springframework.security=INFO
logging.level.reactor.netty.http.client=DEBUG

# Custom logging pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ========== Security ==========
spring.security.require-ssl=false

# ========== Global Filters ==========
spring.cloud.gateway.global-cors.cors-configurations.[/**].allowed-origins=http://localhost:3000,http://localhost:3001,http://localhost:4200
spring.cloud.gateway.global-cors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
spring.cloud.gateway.global-cors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.global-cors.cors-configurations.[/**].allow-credentials=true
spring.cloud.gateway.global-cors.cors-configurations.[/**].max-age=3600